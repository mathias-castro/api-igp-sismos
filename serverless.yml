org: mcastroa
service: igp-sismos-api

provider:
  name: aws
  runtime: python3.12
  memorySize: 1024
  timeout: 29
  region: us-east-1
  iam:
    role: arn:aws:iam::016748221635:role/LabRole
  environment:
    DYNAMODB_TABLE: SismosIGP

functions:
  sismos:
    handler: igp_sismos_api.lambda_handler
    description: "API único GET para scraping y almacenamiento de sismos del IGP"
    events:
      - http:
          path: /
          method: get
          cors: true
      - http:
          path: /sismos
          method: get
          cors: true
      - schedule:
          rate: rate(120 minutes)
          description: "Scraping automático cada 2 horas"
          enabled: true

resources:
  Resources:
    SismosIGPTable:
      Type: AWS::DynamoDB::Table
      Properties:
        TableName: SismosIGP
        AttributeDefinitions:
          - AttributeName: id
            AttributeType: S
          - AttributeName: scraped_at
            AttributeType: S
        KeySchema:
          - AttributeName: id
            KeyType: HASH
        GlobalSecondaryIndexes:
          - IndexName: TimestampIndex
            KeySchema:
              - AttributeName: scraped_at
                KeyType: HASH
            Projection:
              ProjectionType: ALL
            ProvisionedThroughput:
              ReadCapacityUnits: 5 
              WriteCapacityUnits: 5
        BillingMode: PROVISIONED
        ProvisionedThroughput:
          ReadCapacityUnits: 5
          WriteCapacityUnits: 5
        TimeToLiveSpecification:
          AttributeName: ttl
          Enabled: true

custom:
  pythonRequirements: {}
